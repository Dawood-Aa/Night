<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>foncé eod reporting tool</title>
<style>
  /* simple, dark, compact layout */
  :root{
    --bg:#0f0f10;
    --panel:#171717;
    --muted:#cfc7c7;
    --accent1:#ffb6b9;
    --accent2:#ffd6a5;
    --green:#00ff88;
  }
  html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
  body{background:radial-gradient(circle at 10% 10%, #141414 0%, #0b0b0b 60%);color:var(--muted);display:flex;align-items:flex-start;justify-content:center;padding:28px 12px;}
  .app{width:100%;max-width:920px;}
  .navbar{display:flex;align-items:center;gap:12px;padding:12px;border-radius:10px;margin-bottom:18px;background:linear-gradient(180deg, rgba(255,182,193,0.04), rgba(0,0,0,0.2));border:1px solid rgba(255,182,193,0.06)}
  .brand{display:flex;flex-direction:column;}
  h1{margin:0;font-size:18px;background:linear-gradient(90deg,var(--accent1),var(--accent2),#fff);-webkit-background-clip:text;color:transparent;font-weight:700;letter-spacing:.6px}
  .sub{font-size:12px;color:#d9cfd0}
  .grid{display:grid;grid-template-columns:1fr 360px;gap:18px;align-items:start}
  .panel{background:rgba(25,25,25,0.7);border-radius:12px;padding:16px;border:1px solid rgba(255,182,193,0.06);box-shadow:0 10px 30px rgba(0,0,0,0.6)}
  label{display:block;font-size:13px;color:var(--accent2);margin-top:10px;font-weight:600}
  input[type="text"], input[type="date"], input[type="number"], select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,182,193,0.06);background:rgba(30,30,30,0.7);color:#fff;box-sizing:border-box}
  .row{display:flex;gap:10px;align-items:center}
  .small{font-size:13px;color:#bdb0b3}
  .models{display:flex;flex-direction:column;gap:10px;margin-top:12px}
  .model-row{display:grid;grid-template-columns:120px 1fr 110px;gap:10px;align-items:center}
  .model-row input, .model-row select{padding:8px}
  .btn{cursor:pointer;border:none;padding:10px 12px;border-radius:8px;font-weight:700}
  .btn-primary{background:linear-gradient(135deg,#8b0000,#b91c1c);color:#fff;box-shadow:0 8px 20px rgba(185,28,28,0.12)}
  .btn-accent{background:linear-gradient(135deg,var(--accent1),var(--accent2));color:#000}
  .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
  .controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:16px}
  .output{white-space:pre-wrap;font-family:ui-monospace,SFMono-Regular,Menlo,monospace;background:rgba(12,12,12,0.6);padding:12px;border-radius:10px;border:1px solid rgba(255,182,193,0.04);color:#eaeaea}
  .totals{margin-top:12px;font-weight:700;color:var(--green);text-align:center}
  .muted-note{font-size:12px;color:#b8aeb0;margin-top:6px}
  .actions{display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-top:8px}
  .delete-small{background:linear-gradient(135deg,#ff4b5c,#b91c1c);color:#fff;padding:6px 8px;border-radius:6px;font-size:13px}
  @media (max-width:880px){.grid{grid-template-columns:1fr;}.actions{justify-content:center}}
</style>
</head>
<body>
  <div class="app">
    <div class="navbar">
      <div class="brand">
        <h1>foncé eod reporting tool</h1>
        <div class="sub">simple sheet logging • github pages friendly</div>
      </div>
    </div>

    <div class="grid">
      <!-- left: form -->
      <div class="panel">
        <label>shift date (local)</label>
        <input id="shiftDate" type="date" />

        <label>chatter name (optional)</label>
        <input id="chatter" type="text" placeholder="enter your name or chatter" />

        <label style="margin-top:14px">models</label>
        <div class="models" id="modelsContainer"></div>

        <div style="display:flex;gap:8px;margin-top:10px;align-items:center">
          <button class="btn btn-accent" id="addModelBtn">+ add model</button>
          <div class="muted-note">each model has platform, name and gross</div>
        </div>

        <div class="totals" id="totalsArea" style="margin-top:12px">total gross: $0.00 &nbsp; • &nbsp; total net: $0.00</div>

        <div class="controls">
          <button class="btn btn-primary" id="generateBtn">generate report</button>
          <button class="btn btn-ghost" id="copyBtn">copy report</button>
          <button class="btn btn-accent" id="submitBtn">submit report</button>
        </div>

        <div class="muted-note" style="margin-top:10px">
          after deploying the google web app, paste the web app url below and click submit report.
        </div>

        <label style="margin-top:10px">webhook url (google apps script web app)</label>
        <input id="webhookUrl" type="text" placeholder="https://script.google.com/macros/s/XXXXX/exec" />

      </div>

      <!-- right: preview -->
      <div class="panel">
        <label>report preview</label>
        <div class="output" id="output">no report yet. click generate report.</div>

        <div class="actions">
          <button class="delete-small" id="clearBtn">clear all</button>
        </div>

      </div>
    </div>
  </div>

<script>
/* frontend logic - single file, minimal deps */
(function(){
  // initial state
  let modelIndex = 0;
  const modelsContainer = document.getElementById('modelsContainer');
  const totalsArea = document.getElementById('totalsArea');
  const outputEl = document.getElementById('output');
  const addModelBtn = document.getElementById('addModelBtn');
  const generateBtn = document.getElementById('generateBtn');
  const copyBtn = document.getElementById('copyBtn');
  const submitBtn = document.getElementById('submitBtn');
  const clearBtn = document.getElementById('clearBtn');

  // helpers
  function money(n){ return Number(n||0).toFixed(2); }

  function createModelRow(idx, data = {}) {
    const wrap = document.createElement('div');
    wrap.className = 'model-row';
    wrap.dataset.idx = idx;

    const select = document.createElement('select');
    select.name = 'platform'+idx;
    ['OnlyFans','Fanvue','Fansly','custom'].forEach(v=>{
      const o = document.createElement('option'); o.value = v; o.textContent = v; select.appendChild(o);
    });
    if(data.platform) select.value = data.platform;

    const nameInput = document.createElement('input');
    nameInput.type = 'text';
    nameInput.name = 'modelName'+idx;
    nameInput.placeholder = 'model name';
    nameInput.value = data.name || '';

    const grossInput = document.createElement('input');
    grossInput.type = 'number';
    grossInput.step = '0.01';
    grossInput.name = 'gross'+idx;
    grossInput.placeholder = 'gross';
    grossInput.value = data.gross || '';

    // remove button appended beside gross (small)
    const removeBtn = document.createElement('button');
    removeBtn.type = 'button';
    removeBtn.textContent = 'remove';
    removeBtn.className = 'btn btn-ghost';
    removeBtn.style.padding='8px';
    removeBtn.onclick = ()=>{ wrap.remove(); recalcTotals(); };

    // place elements nicely: platform | name | gross+remove (we'll append remove under gross)
    // since css grid uses 3 columns, append gross + remove in a small container
    const grossWrap = document.createElement('div');
    grossWrap.style.display='flex';
    grossWrap.style.gap='8px';
    grossWrap.appendChild(grossInput);
    grossWrap.appendChild(removeBtn);

    wrap.appendChild(select);
    wrap.appendChild(nameInput);
    wrap.appendChild(grossWrap);

    // update totals when gross changes
    grossInput.addEventListener('input', recalcTotals);
    nameInput.addEventListener('input', ()=>{ /* no-op for now */ });

    return wrap;
  }

  function addModel(data){
    const row = createModelRow(modelIndex++, data);
    modelsContainer.appendChild(row);
    recalcTotals();
  }

  function recalcTotals(){
    const rows = modelsContainer.querySelectorAll('.model-row');
    let grossTotal = 0;
    rows.forEach(r=>{
      const idx = r.dataset.idx;
      const g = parseFloat((r.querySelector(`[name='gross${idx}']`)?.value)||0) || 0;
      grossTotal += g;
    });
    const net = grossTotal * 0.8;
    totalsArea.textContent = `total gross: $${money(grossTotal)}  •  total net: $${money(net)}`;
  }

  function collectReport(){
    const shiftDate = document.getElementById('shiftDate').value || '';
    const chatter = document.getElementById('chatter').value.trim() || '';
    const models = [];
    const rows = modelsContainer.querySelectorAll('.model-row');
    rows.forEach(r=>{
      const idx = r.dataset.idx;
      const platform = r.querySelector(`[name='platform${idx}']`)?.value || '';
      const name = r.querySelector(`[name='modelName${idx}']`)?.value.trim() || '';
      const gross = parseFloat(r.querySelector(`[name='gross${idx}']`)?.value || 0) || 0;
      if(name) models.push({ platform, name, gross, net: +(gross*0.8).toFixed(2) });
    });
    const totalGross = models.reduce((s,m)=>s+m.gross,0);
    const totalNet = +(totalGross * 0.8).toFixed(2);
    return { date: shiftDate, chatter, models, totalGross: +totalGross.toFixed(2), totalNet };
  }

  function generateTextReport(data){
    let out = '--- foncé eod report ---\\n\\n';
    out += `date: ${data.date || '(not set)'}\\n`;
    out += `chatter: ${data.chatter || '(none)'}\\n\\n`;
    if(data.models.length===0) out += '(no models)\\n\\n';
    data.models.forEach(m=>{
      out += `platform: ${m.platform}\\nmodel: ${m.name}\\ngross: $${money(m.gross)}\\nnet: $${money(m.net)}\\n\\n`;
    });
    out += `total gross: $${money(data.totalGross)}\\ntotal net: $${money(data.totalNet)}`;
    return out;
  }

  // wire UI
  addModelBtn.onclick = ()=> addModel();
  generateBtn.onclick = ()=>{
    const data = collectReport();
    outputEl.textContent = generateTextReport(data);
    recalcTotals();
  };
  copyBtn.onclick = ()=>{
    const txt = outputEl.textContent;
    if(!txt || txt.includes('no report')){ alert('generate the report first'); return; }
    navigator.clipboard?.writeText(txt).then(()=>alert('report copied to clipboard'), ()=>alert('could not copy'));
  };

  submitBtn.onclick = async ()=>{
    const webhook = (document.getElementById('webhookUrl')?.value || '').trim();
    if(!webhook){ alert('paste your deployed google apps script web app url in the webhook field'); return; }

    // prepare data and preview
    const data = collectReport();
    outputEl.textContent = generateTextReport(data);
    recalcTotals();

    // basic validation
    if(!data.date){ if(!confirm('no date set. continue?')) return; }

    // send
    submitBtn.disabled = true;
    submitBtn.textContent = 'sending...';
    try {
      const res = await fetch(webhook, {
        method: 'POST',
        mode: 'cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      // try json first, but fallback to text
      let parsed;
      try { parsed = await res.json(); } catch(e) { parsed = await res.text(); }
      alert('server responded: ' + (typeof parsed === 'string' ? parsed : JSON.stringify(parsed)));
    } catch (err){
      console.error('network error sending report', err);
      alert('network error sending report: ' + (err && err.message ? err.message : String(err)));
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = 'submit report';
    }
  };

  clearBtn.onclick = ()=>{
    if(!confirm('clear all models and inputs?')) return;
    document.getElementById('shiftDate').value = '';
    document.getElementById('chatter').value = '';
    document.getElementById('webhookUrl').value = '';
    modelsContainer.innerHTML = '';
    modelIndex = 0;
    addModel();
    outputEl.textContent = 'no report yet. click generate report.';
    recalcTotals();
  };

  // init with one row
  addModel();
})();
</script>
</body>
</html>
